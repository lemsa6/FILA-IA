# Redis configuração ultra-otimizada para FILA-IA
# ================================================

# ===== CONFIGURAÇÕES BÁSICAS =====
port 6379
bind 0.0.0.0
protected-mode no
tcp-backlog 511
timeout 0
tcp-keepalive 300

# ===== PERFORMANCE MÁXIMA =====
# Memória
maxmemory 512mb
maxmemory-policy allkeys-lru  # Remove chaves menos usadas quando memória esgota
maxmemory-samples 10

# Persistência otimizada (para cache, menos crítico)
save 900 1      # Salva se pelo menos 1 chave mudou em 900s
save 300 10     # Salva se pelo menos 10 chaves mudaram em 300s
save 60 10000   # Salva se pelo menos 10000 chaves mudaram em 60s

# Desabilita fsync para máxima velocidade (cache pode ser perdido)
appendonly no
appendfsync no

# ===== OTIMIZAÇÕES DE REDE =====
tcp-nodelay yes
tcp-keepalive 300

# ===== CONFIGURAÇÕES DE CLIENTE =====
timeout 0
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 256mb 64mb 60
client-output-buffer-limit pubsub 32mb 8mb 60

# ===== THREADS E PERFORMANCE =====
# Usa múltiplas threads para I/O
io-threads 4
io-threads-do-reads yes

# ===== HASH TABLES OTIMIZADAS =====
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
list-compress-depth 0
set-max-intset-entries 512
zset-max-ziplist-entries 128
zset-max-ziplist-value 64

# ===== OTIMIZAÇÕES ESPECÍFICAS PARA CACHE =====
# Expiração de chaves mais eficiente
hz 100  # Frequência de limpeza de chaves expiradas

# ===== LOGS OTIMIZADOS =====
loglevel notice
logfile ""
syslog-enabled no

# ===== SECURITY =====
# Comandos perigosos desabilitados
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command KEYS ""
rename-command CONFIG "CONFIG_b835c3f8a5d2e7f1"

# ===== CONFIGURAÇÕES ESPECÍFICAS PARA LARAVEL =====
# Otimizações para sessões e cache do Laravel
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes

# ===== MONITORAMENTO =====
latency-monitor-threshold 100  # Monitor latência > 100ms
